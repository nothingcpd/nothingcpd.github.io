<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb">
<head>
  <meta charset="utf-8">
  <meta property="wb:webmaster" content="2ff65170685cd248"/>
  <title>陈品殿的博客</title>

<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1220243215&debug=true" type="text/javascript" charset="utf-8">
</script>
<script>
	function getcookie(objname){//获取指定名称的cookie的值
		var arrstr = document.cookie.split("; ");
		for(var i = 0;i < arrstr.length;i ++){
			var temp = arrstr[i].split("=");
			if(temp[0] == objname) {
				alert(temp[1]);
				//return unescape(temp[1].split("&")[0].split("=")[1]);
				var value = temp[1].split("%26");
				var token = value[0].split("%3D");
				return token[1];
			}
		}
	}
</script>
<script>
	function getWbUserData(token){
        //调用api
		
        WB2.anyWhere(function(W){
            W.parseCMD("/account/get_uid.json",function(ret,status){
                if(status){
                    getData(W,ret.uid);
                }else{
                    console.log("/account/get_uid.json 授权失败或者错误");
                }
            },
			{
				access_token:token
			},
			{
                method:"get",
                cache_time:30
            });
        });
        function getData(W,id){
            W.parseCMD("/users/show.json",function(ret,status){
                if(status){
                    console.log(ret);
                }else{
                    console.log("/users/show.json error");
                }
            },{
				access_token:token,
                uid:id
            },{
                method:"get"
            });
        }
    };
</script>
<script>
WB2.anyWhere(function(W){	
    W.widget.connectButton({
        id: "wb_connect_btn",	
        type:"4,2",
        callback : {
            login:function(o){	//登录后的回调函数	
				var access_token = getcookie('weibojs_1220243215'));
				getWbUserData(access_token);
				//W.parseCMD('oauth2/authorize.json', function(oResult, bStatus) {
				//		if(bStatus) {
				//			//to do something...
				//			alert(oResult);
				//		}
				//		alert(bStatus);
				//		}, {
				//			client_id : '1220243215',
				//			redirect_uri : 'http://www.chenpindian.com/index.html'
				//		}, {
				//			method : 'post'
				//		});	
					
					//}
			},	
            logout:function(){	//退出后的回调函数
            }
        }
    });

});
</script>
</head>
<body>
  <h1>我的第一个标题</h1>
  <a href="https://api.weibo.com/oauth2/authorize?client_id=1220243215&response_type=code&redirect_uri=http://www.chenpindian.com/index.html">授权</a>
  <div id="wb_connect_btn" ></div>
  
</body>
</html>
